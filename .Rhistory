unlist() |> unname() |> as.vector()
if(abs(sum(next_state[-incidence_i]) - parameters$total_population) > 1E-7){
stop("total population for the next cohort states is not correct")
}
dust2::dust_system_set_state(sys = RSV_dust,
state = next_state)
if(all(dust2::dust_system_state(RSV_dust) != next_state)){
stop("states have not been updated")
}
}
return(
invisible(
dplyr::bind_rows(out_list) |>
dplyr::left_join(data.frame(age = parameters$age.limits,
age_chr = age_chr), by = dplyr::join_by(age)) |>
as.data.frame()
)
)
devtools::load_all()
devtools::test()
contact_population_list <- create_contact_matrix()
parameters <- get_parameters(overrides = list(),
contact_population_list = contact_population_list)
out_w_cohort <- RSVsim::run_model(parameters = parameters,
max_t = 3650,
dt = 1,
init_conds = NULL)
ggplot(data = subset(out_w_cohort,
state %in% c("Sp", "Ss", "Ip", "Is", "R") & age %in% c(0, 1, 2, 5, 20, 40, 50)),
aes(x = time, y = value, col = state, group = factor(state))) +
geom_line() +
facet_wrap(~age, scales = "free_y")
ggplot(data = subset(out_w_cohort,
state %in% c("Incidence") & age %in% c(0, 1, 2, 5, 20, 40, 50)),
aes(x = time, y = value, col = state, group = factor(state))) +
geom_line() +
facet_wrap(~age, scales = "free_y")
devtools::build()
odin2::odin_package(path = "inst/odin")
devtools::load_all()
devtools::build()
devtools::install_github("IsaacStopard/RSVsim")
library(RSVsim)
contact_population_list <- create_contact_matrix()
parameters <- get_parameters(overrides = list(),
contact_population_list = contact_population_list)
out_w_cohort <- RSVsim::run_model(parameters = parameters,
max_t = 3650,
dt = 1,
init_conds = NULL)
ggplot(data = subset(out_w_cohort,
state %in% c("Sp", "Ss", "Ip", "Is", "R") & age %in% c(0, 1, 2, 5, 20, 40, 50)),
aes(x = time, y = value, col = state, group = factor(state))) +
geom_line() +
facet_wrap(~age, scales = "free_y")
ggplot(data = subset(out_w_cohort,
state %in% c("Incidence") & age %in% c(0, 1, 2, 5, 20, 40, 50)),
aes(x = time, y = value, col = state, group = factor(state))) +
geom_line() +
facet_wrap(~age, scales = "free_y")
out
out_w_cohort
usethis::use_pkgdown_github_pages()
remotes::install_github('IsaacStopard/RSVsim')
usethis::use_vignette("Introduction")
roxygen2::roxygenise()
devtools::document()
usethis::use_readme_rmd(open = rlang::is_interactive())
devtools::check()
usethis::use_package("ggplot2")
usethis::use_import_from("stats", "na.omit")
devtoos::load_all()
devtools::load_all()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::check()
usethis::use_github_action_check_standard()
?usethis::use_github_action
?usethis::use_github_action("pkgdown")
usethis::use_github_action("pkgdown")
usethis::use_github_action(name = "check-standard.yaml")
install.packages("covr")
usethis::use_github_action(name = "test-coverage")
devtools::check()
covr::codecov()
?covr::codecov
devtools::load_all()
roxygen2::roxygenise()
devtools::build_readme()
devtools::load_all()
?RSVsim::create_contact_matrix
install.packages("pak")
pak::pak("IsaacStopard/GitHub")
pak::pak("IsaacStopard/RSVsim")
contact_population_list()
contact_population_list <- RSVsim::create_contact_matrix()
contact_population_list$matrix_mean
contact_population_list$matrix_mean |> as.data.frame() |> dplyr::row_names_to_column("age_y")
tibble::rownames_to_column()
usethis::use_package("tibble")
ggplot(data = contact_population_list$matrix_mean |> as.data.frame() |>
tibble::row_names_to_column("age_y") |>
dplyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts"),
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
ggplot2::ggplot(data = contact_population_list$matrix_mean |> as.data.frame() |>
tibble::row_names_to_column("age_y") |>
dplyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts"),
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
library(ggplot2)
ggplot(data = contact_population_list$matrix_mean |> as.data.frame() |>
tibble::row_names_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts"),
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
ggplot(data = contact_population_list$matrix_mean |> as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts"),
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
contact_population_list$matrix_mean <- contact_population_list$matrix_mean |> as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts") |>
dplyr::mutate(age_y = as.numeric(age_y), age_x = as.numeric(age_x))
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
age.limits <- c(seq(0, 5, 1/12), seq(10, 70, 5))
library(RSVsim)
library(ggplot2)
# specifying the default age limits to use with the model
age.limits <- c(seq(0, 5, 1/12), seq(10, 70, 5))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
contact_population_list$matrix_mean <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile()
matrx_contacts
contact_population_list$matrix_contacts
contact_population_list$matrix_contacts <- contact_population_list$matrix_contact |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "total_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = total_contacts)) +
geom_tile()
ggplot(data = contact_population_list$matrix_contacts,
aes(x = age_x, y = age_y, fill = total_contacts)) +
geom_tile()
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = seq(0, 70, 5))
contact_population_list$matrix_contacts <- contact_population_list$matrix_contact |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "total_contacts")
ggplot(data = contact_population_list$matrix_contacts,
aes(x = age_x, y = age_y, fill = total_contacts)) +
geom_tile()
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = seq(0, 70, 10))
contact_population_list$matrix_contacts <- contact_population_list$matrix_contact |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "total_contacts")
ggplot(data = contact_population_list$matrix_contacts,
aes(x = age_x, y = age_y, fill = total_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = seq(0, 70, 10))
contact_population_list$matrix_contacts <- contact_population_list$matrix_contact |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = seq(0, 70, 10))
contact_population_list$matrix_mean <- contact_population_list$matrix_contact |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = seq(0, 70, 10))
contact_population_list$matrix_mean <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
# specifying the default age limits to use with the model
age.limits <- c(c(0, 0.5, 1), seq(0, 70, 10)))
c(0, 0.5, 1)
c(c(0, 0.5, 1), seq(10, 70, 10))
# specifying the default age limits to use with the model
age.limits <- c(c(0, 0.5, 1), seq(10, 70, 10))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
contact_population_list$matrix_mean <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = contact_population_list$matrix_mean,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
parameters <- RSVsim::get_parameters(overrides = list("b0" = 3), contact_population_list = contact_population_list)
?RSVsim::run_model
out <- RSVsim::run_model(parameters = parameters,
max_t = 3650, # maximum time to run the model for
dt = 0.5, # time step to get model outputs for
init_conds = NULL)
out
# specifying the default age limits to use with the model
age.limits <- c(c(0, 0.5, 1), seq(10, 60, 20))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
parameters <- RSVsim::get_parameters(overrides = list("b0" = 3),
contact_population_list = contact_population_list)
out <- RSVsim::run_model(parameters = parameters,
max_t = 3650, # maximum time to run the model for
dt = 0.5, # time step to get model outputs for
init_conds = NULL)
ggplot(data = out,
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr)
ggplot(data = out,
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is", "R")),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
parameters <- RSVsim::get_parameters(overrides = list("b0" = 1.5),
contact_population_list = contact_population_list)
out <- RSVsim::run_model(parameters = parameters,
max_t = 3650, # maximum time to run the model for
dt = 0.5, # time step to get model outputs for
init_conds = NULL)
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
seq(0, 0.6, 1/12)
1/6
1/12
1/12 * 6
# specifying the default age limits to use with the model
age.limits <- c(c(0, 1, 1/12), seq(10, 60, 20))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
# specifying the default age limits to use with the model
age.limits <- round(c(c(0, 1, 1/12), seq(10, 60, 20)), digits = 1)
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
round(c(c(0, 1, 1/12), seq(10, 60, 20)), digits = 1)
# specifying the default age limits to use with the model
age.limits <- round(c(seq(0, 1, 1/12), seq(10, 60, 20)), digits = 1)
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
round(c(seq(0, 1, 1/12), seq(10, 60, 20)), digits = 1)
# specifying the default age limits to use with the model
age.limits <- c(seq(0, 0.2, 1), seq(10, 60, 20))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
c(seq(0, 0.2, 1), seq(10, 60, 20))
# specifying the default age limits to use with the model
age.limits <- c(seq(0, 1, 0.2), seq(10, 60, 20))
contact_population_list <- RSVsim::create_contact_matrix(country = "United Kingdom", age.limits = age.limits)
matrix_mean_plot <- contact_population_list$matrix_mean |>
as.data.frame() |>
tibble::rownames_to_column("age_y") |>
tidyr::pivot_longer(-age_y, names_to = "age_x", values_to = "mean_contacts")
ggplot(data = matrix_mean_plot,
aes(x = age_x, y = age_y, fill = mean_contacts)) +
geom_tile() +
xlab("Age") + ylab("Age")
parameters <- RSVsim::get_parameters(overrides = list("b0" = 1.5),
contact_population_list = contact_population_list)
out <- RSVsim::run_model(parameters = parameters,
max_t = 3650, # maximum time to run the model for
dt = 0.5, # time step to get model outputs for
init_conds = NULL)
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
parameters <- RSVsim::get_parameters(overrides = list("b0" = 1),
contact_population_list = contact_population_list)
parameters <- RSVsim::get_parameters(overrides = list("b0" = 1),
contact_population_list = contact_population_list)
out <- RSVsim::run_model(parameters = parameters,
max_t = 3650, # maximum time to run the model for
dt = 0.5, # time step to get model outputs for
init_conds = NULL)
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
ggplot(data = out |> dplyr::filter(state %in% c("Incidence", "DetIncidence") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y")
parameters$prop_detected_vect
devtools::document()
devtools::test()
devtools::check()
devtools::build_readme()
?devtools::build_site
devtools::build_site()
devtools::check()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
# install.packages("pak")
pak::pak("IsaacStopard/RSVsim")
devtools::build_readme()
devtools::document()
devtools::build_site()
devtools::document()
devtools::build_readme()
devtools::build_site()
devtools::build_site()
use_coverage(pkg = ".", type = c("codecov"))
devtools::use_coverage(pkg = ".", type = c("codecov"))
?use_coverage
library(usethis)
use_coverage(, type = c("codecov"))
devtools::test_coverage()
covr::codecov(token = "8c1b3595-401d-42b7-9372-f2d287c2a1aa")
devtools::build_site()
devtools::build_site()
pkgdown::clean_site(force = TRUE)
devtools::build_site()
365.25/12
age.limits = c(seq(0,5,1/12), seq(10,70,5))
365.25/12
parameters$age.limits <- age.limits
parameters <- list()
parameters$age.limits <- age.limits
# age differences in days
size_cohorts <- with(parameters,
c(diff(age.limits * 365.25), max_age*365.25 - age.limits[length(age.limits)]*365.25)
)
parameters$max_age <- 90
# age differences in days
size_cohorts <- with(parameters,
c(diff(age.limits * 365.25), max_age*365.25 - age.limits[length(age.limits)]*365.25)
)
size_cohorts
cohort_step_size/size_cohorts
cohort_step_size = 365.25/12
cohort_step_size/size_cohorts
cohort_step_size = 10
# running for the time of the smallest cohort
transition_rate <- cohort_step_size/size_cohorts
transition_rate
365.25/12
devtools::check()
devtools::document()
devtools::build_vignettes()
devtools::build_site()
pkgdown::clean_site(force = TRUE)
devtools::build_site()
devtools::load_all()
contact_population_list <- create_contact_matrix()
parameters <- get_parameters(contact_population_list = contact_population_list)
out <- run_model(parameters = parameters)
out
devtools::test()
devtools::check()
devtools::check()
devtools::load_all()
?run_model
out <- run_model(parameters = parameters, cohort_step_size = 10)
ggplot(data = out |> dplyr::filter(state %in% c("Incidence", "DetIncidence") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
library(ggplot2)
ggplot(data = out |> dplyr::filter(state %in% c("Incidence", "DetIncidence") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
unique(out$state)
out <- run_model(parameters = parameters, cohort_step_size = 10, max_t = 3650)
ggplot(data = out |> dplyr::filter(state %in% c("Incidence", "DetIncidence") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
age.limits <- c(seq(0, 5, 0.5), 5, 10, seq(20, 80, 20))
create_contact_matrix(age.limits = age.limits)
age.limits <- c(seq(0, 5, 0.5), 10, seq(20, 80, 20))
age.limits
create_contact_matrix(age.limits = age.limits)
contact_population_list <- create_contact_matrix(age.limits = age.limits)
parameters <- get_parameters(contact_population_list = contact_population_list)
out <- run_model(parameters = parameters, cohort_step_size = 10, max_t = 3650)
ggplot(data = out |> dplyr::filter(state %in% c("Incidence", "DetIncidence") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
ggplot(data = out |> dplyr::filter(state %in% c("Sp", "Ip", "Ss", "Is") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
odin::odin_package(path = "inst/odin")
odin2::odin_package(path = "inst/odin")
odin2::odin_package(path = "inst/odin")
devtools::test()
devtools::load_all()
contact_population_list <- create_contact_matrix()
parameters <- get_parameters(contact_population_list = contact_population_list)
sim <- run_model(parameters = parameters,
max_t = 2000,
cohort_step_size = 365.25/12,
dt = 0.25,
init_conds = NULL)
devtools::load_all()
devtools::test()
devtools::build()
devtools::document()
contact_population_list <- create_contact_matrix(age.limits = age.limits)
parameters <- get_parameters(contact_population_list = contact_population_list)
out <- run_model(parameters = parameters, max_t = 3650, cohort_step_size = 10)
ggplot(data = out |> dplyr::filter(state %in% c("prev", "prev_s", "prev_p") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw()
ggplot(data = out |> dplyr::filter(state %in% c("prev", "prev_s", "prev_p") & time > (3650 - 365 * 3)),
aes(x = time, y = value, col = state)) +
geom_line() +
facet_wrap(~age_chr, scales = "free_y") + theme_bw() + ylab("Prevalence")
